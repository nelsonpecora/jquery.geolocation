(function(e){e.fn.geolocate=function(t,n,r){var i=function(e,t,n){var r=new Date,i=new Date;if(n===null||n===0)n=1;i.setTime(r.getTime()+864e5*n);document.cookie=e+"="+t+";expires="+i.toGMTString()+"; path=/"},s=function(e){var t=new RegExp("[; ]"+e+"=([^\\s;]+)"),n=(" "+document.cookie).match(t);return e&&n?n[1]:!1},o=s("mycountry");if(o===!1||o.length<1){var u,a,f;navigator.geolocation&&n?e.getScript("https://maps.googleapis.com/maps/api/js?key="+n+"&sensor=true").done(function(){function n(e){a=e.coords.latitude;f=e.coords.longitude;var n=new google.maps.Geocoder,s=new google.maps.LatLng(a,f);n.geocode({latLng:s},function(e,n){if(n===google.maps.GeocoderStatus.OK){var s=e.length-1,o=e[s].formatted_address;if(t&&typeof t=="array"){for(var a=0,f=t.length;a<f;a++)if(o===t[a]){u=o;break}}else u=o;if(!u)return!1;i("mycountry",u,14);r&&r()}else alert("Region lookup failed due to: "+n)})}function s(e){var t={1:"Permission denied",2:"Position unavailable",3:"Request timeout"};alert("Error: "+t[e.code])}var e=1e4;navigator.geolocation.getCurrentPosition(n,s,{timeout:e,maximumAge:0})}).fail(function(){alert("Error retrieving location from Google Maps.")}):e.getScript("http://j.maxmind.com/app/country.js").done(function(){var e=geoip_country_name();if(t&&typeof t=="array"){for(var n=0,i=t.length;n<i;n++)if(e===t[n]){u=e;break}}else u=e;if(!u)return!1;window.setCookie("mycountry",u,14);r&&r()}).fail(function(){alert("Error retrieving location from IP Address")})}else r&&r()}})(jQuery);