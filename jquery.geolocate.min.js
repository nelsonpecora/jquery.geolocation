(function(e){e.fn.geolocate=function(t,n,r){var i=function(e,t,n){var r=new Date,i=new Date;if(n===null||n===0)n=1;i.setTime(r.getTime()+864e5*n);document.cookie=e+"="+t+";expires="+i.toGMTString()+"; path=/"},s=function(e){var t=new RegExp("[; ]"+e+"=([^\\s;]+)"),n=(" "+document.cookie).match(t);return e&&n?n[1]:!1},o=function(){try{return"localStorage"in window&&window.localStorage!==null}catch(e){return!1}},u=o()===!0?localStorage.getItem("mycountry"):s("mycountry");if(u===!1||u===null||u.length<1){var a,f,l;navigator.geolocation&&n?e.getScript("https://maps.googleapis.com/maps/api/js?key="+n+"&sensor=true").done(function(){function n(e){f=e.coords.latitude;l=e.coords.longitude;var n=new google.maps.Geocoder,s=new google.maps.LatLng(f,l);n.geocode({latLng:s},function(e,n){if(n===google.maps.GeocoderStatus.OK){var s=e.length-1,u=e[s].formatted_address;if(t&&typeof t=="array"){for(var f=0,l=t.length;f<l;f++)if(u===t[f]){a=u;break}}else a=u;if(!a)return!1;o()===!0?localStorage.setItem("mycountry",a):i("mycountry",a,14);r&&r()}else alert("Region lookup failed due to: "+n)})}function s(e){var t={1:"Permission denied",2:"Position unavailable",3:"Request timeout"};alert("Error: "+t[e.code])}var e=1e4;navigator.geolocation.getCurrentPosition(n,s,{timeout:e,maximumAge:0})}).fail(function(){alert("Error retrieving location from Google Maps.")}):e.getScript("http://j.maxmind.com/app/country.js").done(function(){var e=geoip_country_name();if(t&&typeof t=="array"){for(var n=0,s=t.length;n<s;n++)if(e===t[n]){a=e;break}}else a=e;if(!a)return!1;o()===!0?localStorage.setItem("mycountry",a):i("mycountry",a,14);r&&r()}).fail(function(){alert("Error retrieving location from IP Address")})}else r&&r()}})(jQuery);